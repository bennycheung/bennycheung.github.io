<!-- Code Copy Button and Language Label -->
<script>
$(document).ready(function() {
  $('pre').each(function() {
    var $pre = $(this);
    var $code = $pre.find('code');

    // Detect language from code class (e.g., language-python, language-bash)
    var lang = '';
    if ($code.length) {
      var codeClass = $code.attr('class') || '';
      var langMatch = codeClass.match(/language-(\w+)/);
      if (langMatch) {
        lang = langMatch[1];
      }
    }

    // Check parent for highlight class (Jekyll highlight blocks)
    var $parent = $pre.parent();
    if (!lang && $parent.hasClass('highlight')) {
      var parentClass = $parent.attr('class') || '';
      var highlightMatch = parentClass.match(/highlight-(\w+)/);
      if (highlightMatch) {
        lang = highlightMatch[1];
      }
    }

    // Set language data attribute for CSS label
    if (lang) {
      $pre.attr('data-lang', lang);
    }

    // Add copy button
    var $btn = $('<button class="btn btn-xs btn-default code-copy-btn" title="Copy code">')
      .html('<i class="fa fa-clipboard"></i>')
      .click(function() {
        var code = $code.text() || $pre.text();
        navigator.clipboard.writeText(code).then(function() {
          $btn.html('<i class="fa fa-check"></i>').addClass('copied');
          setTimeout(function() {
            $btn.html('<i class="fa fa-clipboard"></i>').removeClass('copied');
          }, 2000);
        });
      });
    $pre.prepend($btn);
  });
});
</script>
